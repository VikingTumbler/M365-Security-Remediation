# M365 Security & IAM Intelligence Report

**Tenant:** {{ tenant_name }}
**Scan ID:** {{ scan_id }}
**Generated:** {{ generated_utc }}
**Mode:** READ-ONLY (no tenant modifications)

---

## Overall Security Posture

| Metric | Value |
|--------|-------|
| **Overall Score** | **{{ "%.1f"|format(score.overall_score) }} / 100** |
| **Risk Rating** | **{{ score.risk_rating }}** |
| Total Findings | {{ score.total_findings }} |
| Critical | {{ score.critical_findings }} |
| High | {{ score.high_findings }} |
| Attack Paths Triggered | {{ score.attack_paths|length }} |

## Domain Scores

| Domain | Score | Weight | Findings | Critical | High | Maturity |
|--------|-------|--------|----------|----------|------|----------|
{% for ds in domain_scores.values() %}
| {{ ds.display_name }} | {{ "%.1f"|format(ds.raw_score) }} | {{ "%.0f"|format(ds.weight * 100) }}% | {{ ds.finding_count }} | {{ ds.critical_count }} | {{ ds.high_count }} | {{ "%.1f"|format(ds.maturity_level) }} |
{% endfor %}

## Top 10 Structural Weaknesses

{% for weakness in top_weaknesses[:10] %}
### {{ loop.index }}. {{ severity_icons.get(weakness.severity|lower, '⚪') }} {{ weakness.control }} ({{ weakness.severity }})

**Domain:** {{ weakness.domain }}
**Maturity Level:** {{ weakness.maturity_level|default('N/A') }}
**Impact Score:** {{ weakness.impact_score|default('N/A') }}

{% if weakness.risk_explanation %}
> **Risk:** {{ weakness.risk_explanation }}
{% endif %}

{% if weakness.exploit_scenario %}
> **Exploit Scenario:** {{ weakness.exploit_scenario }}
{% endif %}

{% if weakness.blast_radius %}
> **Blast Radius:** {{ weakness.blast_radius }}
{% endif %}

{% endfor %}

## Attack Path Simulation

{% if attack_paths %}
{% for path in attack_paths %}
### ⚡ {{ path.attack_path }}

**Risk Level:** {{ path.risk_level|upper }}

{{ path.description }}

**Business Impact:** {{ path.impact }}

{% if path.matched_domains %}
**Matched Domains:**
{% for d, sevs in path.matched_domains.items() %}
  - `{{ d }}`: {{ sevs|join(', ') }}
{% endfor %}
{% endif %}

{% endfor %}
{% else %}
No multi-domain attack paths triggered based on current findings.
{% endif %}

## Control Coverage Matrix

| Domain | Findings | Maturity | Gap to Target (3.0) | Status |
|--------|----------|----------|---------------------|--------|
{% for ds in domain_scores.values() %}
{% set gap = [0, 3.0 - ds.maturity_level]|max %}
{% if gap <= 0.5 %}
{% set status = "✅ On Track" %}
{% elif gap <= 1.5 %}
{% set status = "⚠️ Gap" %}
{% else %}
{% set status = "❌ Critical Gap" %}
{% endif %}
| {{ ds.display_name }} | {{ ds.finding_count }} | {{ "%.1f"|format(ds.maturity_level) }} | {{ "%.1f"|format(gap) }} | {{ status }} |
{% endfor %}

## Framework Alignment

{% if framework.zero_trust %}
### Zero Trust Pillars

{% for pillar, mapped in framework.zero_trust.items() %}
- **{{ pillar|title }}**: {{ mapped|length }} finding(s)
{% endfor %}
{% endif %}

{% if framework.cis_benchmark %}
### CIS M365 Benchmark

{% for ref, mapped in framework.cis_benchmark.items()|sort %}
- **{{ ref }}**: {{ mapped|length }} finding(s)
{% endfor %}
{% endif %}

{% if framework.nist_families %}
### NIST 800-53 Families

{% for family, mapped in framework.nist_families.items()|sort %}
- **{{ family }}**: {{ mapped|length }} finding(s)
{% endfor %}
{% endif %}

## Detailed Findings

{% for domain, domain_findings in findings|groupby('domain') %}
### {{ domain|replace('_', ' ')|title }}

{% for f in domain_findings|sort(attribute='severity') %}
#### {{ severity_icons.get(f.severity|lower, '⚪') }} {{ f.control_name }}

| Field | Value |
|-------|-------|
| ID | `{{ f.id }}` |
| Severity | {{ f.severity }} |
| Maturity | {{ f.maturity_level }} |
{% if f.cis_benchmark %}
| CIS Benchmark | {{ f.cis_benchmark }} |
{% endif %}
{% if f.nist_family %}
| NIST Family | {{ f.nist_family }} |
{% endif %}
{% if f.zero_trust_pillar %}
| Zero Trust Pillar | {{ f.zero_trust_pillar }} |
{% endif %}

**Detection Logic:** {{ f.detection_logic }}

{% if f.evidence %}
**Evidence:**
```json
{{ f.evidence|tojson(indent=2) }}
```
{% endif %}

{% if f.risk_explanation %}
> {{ f.risk_explanation }}
{% endif %}

{% if f.exploit_scenario %}
**Exploit Scenario:** {{ f.exploit_scenario }}
{% endif %}

{% if f.blast_radius %}
**Blast Radius:** {{ f.blast_radius }}
{% endif %}

{% endfor %}
{% endfor %}

---
*Report generated by M365 Security & IAM Intelligence Engine v1.0.0*
